// SpeedDial
// Handles popup behaviors
// @author Vivek Bhookya
// @author Deepika Gudavalli

// TODO::
// o create arrays of organizations with their phone numbers per state ugh

// Extra credit
// o When clicking a phone number, open a Google hangouts call with that number

// Finished
// √ Save state submitted when users click "submit" into chrome.storage.sync
// √ When opening SpeedDial, we check first if a state is saved
// + If a state is saved, we populate the list and display popup2.html with the numbers
// + If no state is saved, we display popup1.html so users can specify a list
// √ Add a way for users to change the state they are in

// alchol anonymous
// planned parenthood
// suicide helplines
// drug helplines
// mental help helplines
// sexual abuse support helplines

// copy paste this for the states:
// 'AL': [],
// 'AK': [],
// 'AZ': [],
// 'AR': [],
// 'CA': [],
// 'CO': [],
// 'CT': [],
// 'DE': [],
// 'DC': [],
// 'FL': [],
// 'GA': [],
// 'HI': [],
// 'ID': [],
// 'IL': [],
// 'IN': [],
// 'IA': [],
// 'KS': [],
// 'KY': [],
// 'LA': [],
// 'ME': [],
// 'MD': [],
// 'MA': [],
// 'MI': [],
// 'MN': [],
// 'MS': [],
// 'MO': [],
// 'MT': [],
// 'NE': [],
// 'NV': [],
// 'NH': [],
// 'NJ': [],
// 'NM': [],
// 'NY': [],
// 'NC': [],
// 'ND': [],
// 'OH': [],
// 'OK': [],
// 'OR': [],
// 'PA': [],
// 'RI': [],
// 'SC': [],
// 'SD': [],
// 'TN': [],
// 'TX': [],
// 'UT': [],
// 'VT': [],
// 'VA': [],
// 'WA': [],
// 'WV': [],
// 'WI': [],
// 'WY'
//

// replace these with organizations
var alcoholAnon = {
 'AL': [2052900060, 3342644122, 2514799994, 2568850323, 3347923422, 2568940120, 8559761008, 2567366000, 2565866621],
 'AK': [9072722312, 8447514393, 9073764777],
 'AZ': [6022641341, 5206244183, 6239377770, 9284458691],
 'AR': [5016647303, 5016236328, 4792537956, 4799673260, 8709331518],
 'CA': [7145564555, 7074462244, 8183624410, 6613224025, 7075462066, 7607582514, 6505771310, 5629897697, 8313733713, 9516951535, 8053891444, 9259394155, 5592216907, 2095331134, 9516539312, 2095722970, 5302726287, 6192658762, 7075576318],
 'CO': [3033224440, 7195461173, 9702243552, 3032385693, 7195735020, 3034478201, 9702459649, 9704760572, 3036957766, 3036599953, 3032879950],
 'CT': [2037786777, 8604821214, 8602239929, 2038695221, 8602675857, 8603549843, 2037552124, 2037552124],
 'DE': [3026555113],
 'DC': [2029669783, 3015876191],
 'FL': [8636880211, 9043998535, 9414267723, 9544620265, 4072605408, 3523728091, 3052968654, 8139339123, 3216330052, 8504334191, 3867584283, 7273239644, 9042642621, 8502241818, 3523600960, 5612764581, 7725621114, 3056422805, 8502442421, 3052386451],
 'GA': [4787452588, 4045253178, 9123563688, 7068608331, 7702537668, 7062799944, 7063742366, 2292739045, 2293776174, 4043517121, 7709387759, 7067761069, 7066784983],
 'HI': [8089461438],
 'ID': [2086674633, 2087563700, 2087212989],
 'IL': [3098287092, 3096871329, 2173734200, 3096869527, 2173732063, 3123461475, 3092749913, 8157416637],
 'IN': [3176327864, 7657421666, 8124344952, 5742347007, 2198446695, 7654548799, 2604716262, 2606688050, 5742958188, 5747537403],
 'IA': [3193389111, 5152828550, 3193655955, 5633245655, 5635567921, 3197527409, 6414236266, 5633594152, 3193387666, 5633245655, 7123289979, 5152669478, 5633229191, 6416281212, 7122521333, 5632634407],
 'KS': [8164717229, 7858233338, 8163779432, 9133719876, 9135356940, 7852352226, 3166843661, 7858420110, 8168616678, 8164717229, 9134929697, 8164369706, 9133833208, 9134413277, 8162148612, 8164529398, 8169141856, 9137245172, 9137229801],
 'KY': [2707825267, 8594917181, 2706830371, 2703627141, 8004678019, 8594917181, 8592330501, 5027100100],
 'LA': [3188652172, 5048383399, 2259300026, 3185616119, 9856268311, 3379910830, 2128703400],
 'ME': [2077744335],
 'MD': [4102724150, 4105432266, 3017331109, 3015876191, 3016620544],
 'MA': [6174269444, 4135322111, 4134482382, 5086277084, 5087529000],
 'MI': [3138315550, 2483323521, 2485416565, 2696845304, 5173771444, 6169139149, 2699647577, 6163923360, 5172653590, 7344820707, 2314144070, 6168477959],
 'MN': [9529220880, 9528811856, 6512275502, 8664232969, 5072895636, 6514522921, 6517770405, 2188293740, 9524476005, 6514233622, 3205878436, 9529353595, 5073888989, 6128712218, 3202353413, 6516454005, 6128613900, 7637815102, 3206321875],
 'MS': [6019820081, 6016361134, 6622803435, 6014822498, 6628461132, 6014260108, 6016931234],
 'MO': [3146473677, 5734424424, 8164717229, 5733580101, 8887404568, 8164619683, 8164610039, 8164619691, 4178237125, 8168616678],
 'MT': [8886072000],
 'NE': [4024385214, 4023719859, 7122521333, 4025561880, 4025561880],
 'NV': [7753249210, 7753551151, 7025981888, 7023878744, 7027965222, 7024339550],
 'NH': [6036226967],
 'NJ': [9086878566, 9738240555, 6095866902, 8564864444, 6096418855, 8564864446],
 'NM': [5754309502, 5059828932, 5052661900],
 'NY': [2128703400, 2126471680, 5162923040, 5164815138],
 'NC': [8282548539, 3362496636, 9104860738, 3367256031, 9104553666, 7048786404, 7043770244, 3368544278, 9197838214, 3368544278, 3368858520, 9199333877, 2526333716, 2527268540, 9198947070, 9197354221, 8288374440, 2529777744, 7048651561, 9105790303],
 'ND': [7012329930],
 'OH': [6142538501, 2162417387, 3302538181, 3304911989, 4193809862, 9372222211, 5133510422, 4196255995, 5133510422, 4195224800, 5134230102, 7406534869, 4409928383, 7403932439],
 'OK': [4055241100, 4055241100, 4058421200, 4058434630, 9186272224, 4057938005, 4059490910, 4053301160, 4052626573, 4057875777, 5802429000, 4058434630, 4057329084],
 'OR': [5414740782, 5032238569, 5034721172, 5417321850, 5413424113, 5412651953, 5418834970, 5412693265, 5033990599, 5038428958, 5036840415],
 'PA': [5704248532, 2155359609, 8144522675, 7172345390, 4124717472, 5706540488, 6103736500, 8142373757, 5703874940, 5702965344, 6103233450, 6103529897, 2153579821],
 'RI': [4017398777, 4014388860],
 'SC': [8032545301, 8642336454, 8645851930, 8434457119, 8435542998],
 'SD': [6056926070, 6052251292, 6055823833],
 'TN': [6158311050, 8655229667, 9014541414, 9316470225, 4234996003, 4239280871, 4234996003, 9017266750, 4234996003, 8656931317, 9313631854],
 'TX': [4099481591, 9728671115, 9406273800, 2547543336, 5123279927, 5124440071, 2813912463, 2812928334, 2812888191, 3256732711, 2108216325, 5127937168, 8306250057, 5128639938, 9729316334, 9405669989, 3619928911, 9725489161, 9724364516, 7136866300],
 'UT': [8013645520, 8013934728, 4356744791, 4356490022, 8014847871, 8013758620, 4356359603],
 'VT': [8022957611, 8022575801, 8028858281, 8023341213],
 'VA': [7032939753],
 'WA': [2534748897, 2065872838, 3604799050, 4252522525, 3602992826, 5095439924, 5094537680, 3604524212, 2532882237, 3603850266, 3603764522, 5096241442, 4256720987],
 'WV': [3042529444, 3042347511],
 'WI': [4147719119, 9209227512, 9204104620, 2627231224, 6083640520, 9204523375, 7158421120, 6082228989, 6082569682, 9207314331, 2626349656, 7153862932, 6127357276, 2625546611],
 'WY': [3076327706]
};
var plannedParent = {
 'AL': [],
 'AK': [],
 'AZ': [],
 'AR': [],
 'CA': [],
 'CO': [],
 'CT': [],
 'DE': [],
 'DC': [],
 'FL': [],
 'GA': [],
 'HI': [],
 'ID': [],
 'IL': [],
 'IN': [],
 'IA': [],
 'KS': [],
 'KY': [],
 'LA': [],
 'ME': [],
 'MD': [],
 'MA': [],
 'MI': [],
 'MN': [],
 'MS': [],
 'MO': [],
 'MT': [],
 'NE': [],
 'NV': [],
 'NH': [],
 'NJ': [],
 'NM': [],
 'NY': [],
 'NC': [],
 'ND': [],
 'OH': [],
 'OK': [],
 'OR': [],
 'PA': [],
 'RI': [],
 'SC': [],
 'SD': [],
 'TN': [],
 'TX': [],
 'UT': [],
 'VT': [],
 'VA': ['8046126126', '8046126126', '8046126126', '8046126126'],
 'WA': [],
 'WV': [],
 'WI': [],
 'WY': []
};
var suicideHelp = {
 'AL': [],
 'AK': [],
 'AZ': [],
 'AR': [],
 'CA': [],
 'CO': [],
 'CT': [],
 'DE': [],
 'DC': [],
 'FL': [],
 'GA': [],
 'HI': [],
 'ID': [],
 'IL': [],
 'IN': [],
 'IA': [],
 'KS': [],
 'KY': [],
 'LA': [],
 'ME': [],
 'MD': [],
 'MA': [],
 'MI': [],
 'MN': [],
 'MS': [],
 'MO': [],
 'MT': [],
 'NE': [],
 'NV': [],
 'NH': [],
 'NJ': [],
 'NM': [],
 'NY': [],
 'NC': [],
 'ND': [],
 'OH': [],
 'OK': [],
 'OR': [],
 'PA': [],
 'RI': [],
 'SC': [],
 'SD': [],
 'TN': [],
 'TX': [],
 'UT': [],
 'VT': [],
 'VA': ['8046126126', '8046126126', '8046126126', '8046126126'],
 'WA': [],
 'WV': [],
 'WI': [],
 'WY': []
};
var drugHelp = {
 'AL': [],
 'AK': [],
 'AZ': [],
 'AR': [],
 'CA': [],
 'CO': [],
 'CT': [],
 'DE': [],
 'DC': [],
 'FL': [],
 'GA': [],
 'HI': [],
 'ID': [],
 'IL': [],
 'IN': [],
 'IA': [],
 'KS': [],
 'KY': [],
 'LA': [],
 'ME': [],
 'MD': [],
 'MA': [],
 'MI': [],
 'MN': [],
 'MS': [],
 'MO': [],
 'MT': [],
 'NE': [],
 'NV': [],
 'NH': [],
 'NJ': [],
 'NM': [],
 'NY': [],
 'NC': [],
 'ND': [],
 'OH': [],
 'OK': [],
 'OR': [],
 'PA': [],
 'RI': [],
 'SC': [],
 'SD': [],
 'TN': [],
 'TX': [],
 'UT': [],
 'VT': [],
 'VA': ['8046126126', '8046126126', '8046126126', '8046126126'],
 'WA': [],
 'WV': [],
 'WI': [],
 'WY': []
};
var YWCA = {
 'AL': [],
 'AK': [],
 'AZ': [],
 'AR': [],
 'CA': [],
 'CO': [],
 'CT': [],
 'DE': [],
 'DC': [],
 'FL': [],
 'GA': [],
 'HI': [],
 'ID': [],
 'IL': [],
 'IN': [],
 'IA': [],
 'KS': [],
 'KY': [],
 'LA': [],
 'ME': [],
 'MD': [],
 'MA': [],
 'MI': [],
 'MN': [],
 'MS': [],
 'MO': [],
 'MT': [],
 'NE': [],
 'NV': [],
 'NH': [],
 'NJ': [],
 'NM': [],
 'NY': [],
 'NC': [],
 'ND': [],
 'OH': [],
 'OK': [],
 'OR': [],
 'PA': [],
 'RI': [],
 'SC': [],
 'SD': [],
 'TN': [],
 'TX': [],
 'UT': [],
 'VT': [],
 'VA': ['8046126126', '8046126126', '8046126126', '8046126126'],
 'WA': [],
 'WV': [],
 'WI': [],
 'WY': []
};

$(document).ready(function () {
  init();

  // Save the state to storage
  $("#submit").click(save);
  // Clear the state to enable the user to add a new state
  $("#change").click(remove);
});

// Function init()
// Grab STATE from storage and replace 'test values' with the state
function init() {
  chrome.storage.sync.get('STATE', function(returnedObj) {
    // If no STATE is currently saved, open the first popup
    // Second conditional is in place to avoid a permanent loop of refreshing the popup -- this rendered
    //  selecting a state very difficult
    if (!returnedObj.STATE &&
      window.location.href === 'chrome-extension://cjbjlcdbnfckcbodkefdlihlbahaokig/popup2.html') {
      window.open('popup1.html', "_self");
      // window.open('tel:+13096602340');
    }

    document.getElementById('stateAbr').innerHTML = returnedObj.STATE;
    populate_list(returnedObj.STATE);
  });

}

// Function populate_list()
// Calls addNumbers for each organization and their phone numbers
//  for the selected state
function populate_list(state) {
    addNumbers('YWCA', YWCA[state]);    addNumbers('Alcoholics anonymous', alcoholAnon[state]);

    // addNumbers(blah['whatever'])
}

// Function save()
// Saves the user's state in chrome.storage
function save() {
  // [0] selects the dropdown part of the form ( [dropdown:submit button] )
  // .value gets what is selected
  let state = document.getElementById('state')[0].value;
  chrome.storage.sync.set( {STATE: state}, function() {});
}

// Function remove()
// Removes STATE in storage to enable the user to add a new state
function remove() {
  chrome.storage.sync.remove('STATE', function() {});
}


// Function addNumbers()
// Adds li objects of the organizations and their phone numbers
//  for the selected state
function addNumbers(org, numbers) {
  // Create the object for the organization name
  let li = document.createElement("p");
  let t = document.createTextNode(org);
  li.appendChild(t);
  document.getElementById("numbers").appendChild(li);

  // Now, create the objects for the numbers
  for (let i = 0; numbers[i] !== undefined; i++) {
    li = document.createElement("li");
    t = document.createTextNode(numbers[i]);
    li.appendChild(t);
    li.id = 'number';
    document.getElementById("numbers").appendChild(li);
  }

}
